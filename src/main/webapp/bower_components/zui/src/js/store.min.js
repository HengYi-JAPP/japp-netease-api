(function(window,$){"use strict";var lsName="localStorage";var storage,dataset,pageName="page_"+window.location.pathname+window.location.search;var Store=function(){this.slience=true;try{if(lsName in window&&window[lsName]&&window[lsName].setItem){this.enable=true;storage=window[lsName]}}catch(e){}if(!this.enable){dataset={};storage={getLength:function(){var length=0;$.each(dataset,function(){length++});return length},key:function(index){var key,i=0;$.each(dataset,function(k){if(i===index){key=k;return false}i++});return key},removeItem:function(key){delete dataset[key]},getItem:function(key){return dataset[key]},setItem:function(key,val){dataset[key]=val},clear:function(){dataset={}}}}this.storage=storage;this.page=this.get(pageName,{})};Store.prototype.pageSave=function(){if($.isEmptyObject(this.page)){this.remove(pageName)}else{var forDeletes=[],i;for(i in this.page){var val=this.page[i];if(val===null)forDeletes.push(i)}for(i=forDeletes.length-1;i>=0;i--){delete this.page[forDeletes[i]]}this.set(pageName,this.page)}};Store.prototype.pageRemove=function(key){if(typeof this.page[key]!="undefined"){this.page[key]=null;this.pageSave()}};Store.prototype.pageClear=function(){this.page={};this.pageSave()};Store.prototype.pageGet=function(key,defaultValue){var val=this.page[key];return defaultValue!==undefined&&(val===null||val===undefined)?defaultValue:val};Store.prototype.pageSet=function(objOrKey,val){if($.isPlainObject(objOrKey)){$.extend(true,this.page,objOrKey)}else{this.page[this.serialize(objOrKey)]=val}this.pageSave()};Store.prototype.check=function(){if(!this.enable){if(!this.slience)throw new Error("Browser not support localStorage or enable status been set true.")}return this.enable};Store.prototype.length=function(){if(this.check()){return storage.getLength?storage.getLength():storage.length}return 0};Store.prototype.removeItem=function(key){storage.removeItem(key);return this};Store.prototype.remove=function(key){return this.removeItem(key)};Store.prototype.getItem=function(key){return storage.getItem(key)};Store.prototype.get=function(key,defaultValue){var val=this.deserialize(this.getItem(key));if(typeof val==="undefined"||val===null){if(typeof defaultValue!=="undefined"){return defaultValue}}return val};Store.prototype.key=function(index){return storage.key(index)};Store.prototype.setItem=function(key,val){storage.setItem(key,val);return this};Store.prototype.set=function(key,val){if(val===undefined)return this.remove(key);this.setItem(key,this.serialize(val));return this};Store.prototype.clear=function(){storage.clear();return this};Store.prototype.forEach=function(callback){var length=this.length();for(var i=length-1;i>=0;i--){var key=storage.key(i);callback(key,this.get(key))}return this};Store.prototype.getAll=function(){var all={};this.forEach(function(key,val){all[key]=val});return all};Store.prototype.serialize=function(value){if(typeof value==="string")return value;return JSON.stringify(value)};Store.prototype.deserialize=function(value){if(typeof value!=="string")return undefined;try{return JSON.parse(value)}catch(e){return value||undefined}};$.zui({store:new Store})})(window,jQuery);